package com.arnyminerz.filamagenta.core.data.tb

import androidx.room.Entity
import com.arnyminerz.filamagenta.core.utils.capitalized
import com.arnyminerz.filamagenta.core.utils.toJava8
import java.sql.ResultSet
import java.time.LocalDate
import java.time.LocalDateTime
import java.time.ZoneId

@Entity(tableName = "socios", primaryKeys = ["idSocio"])
data class Socio(
    val idSocio: Long,
    val Nombre: String,
    val Apellidos: String,
    val Direccion: String?,
    val idCodPostal: Int?,
    val Dni: String?,
    val FecNacimiento: LocalDateTime?,
    val TlfParticular: String?,
    val TlfTrabajo: String?,
    val TlfMovil: String?,
    val eMail: String?,
    val idEstadoCivil: Int?,
    val idEstadoFicha: Int?,
    val bDerechoActos: Boolean?,
    val FecAlta: LocalDateTime?,
    val FecUltAlta: LocalDateTime?,
    val AnyAltaJuvenil: Int?,
    val AnyAltaFester: Int?,
    val FecBaja: LocalDateTime?,
    val AnyMuntanyesMerit: Int?,
    val bRodaBlancos: Boolean?,
    val bRodaNegros: Boolean?,
    val nrAntiguedad: Int?,
    val bArrancoDianaJuvenil: Boolean?,
    val AnyAltaRodaBlancos: Int?,
    val nrRodaBlancos: Int?,
    val AnyAltaRodaNegros: Int?,
    val nrRodaNegros: Int?,
    val AnyUltEscuadra: Int?,
    val idPuestoEscuadra: Int?,
    val AnyUltEscuadraEspecial: Int?,
    val idPuestoEscuadraEspecial: Int?,
    val AnyGloriero: Int?,
    val idFormaPago: Int?,
    val Sexo: Boolean?,
    val idTipoFestero: Int?,
    val idCargo: Int?,
    val Obs: String?,
    val Fotografia: String?,
    val AsociadoCon: Int?,
    val bCarnetAvancarga: Boolean?,
    val FecCaducidadAvancarga: LocalDateTime?,
    val bDisparaAvancarga: Boolean?,
    val idParentesco: Int?,
    val bEnviadoAsociacion: Boolean?,
    val bTipoFesteroBloqueado: Boolean?,
    val ImpLoteriaAbonado: Double?,
    val bAbonadoLoteria: Boolean?,
    val idBanco: Int?,
    val Iban: String?,
    val Bic: String?,
    val bUsaMontepio: Boolean?,
    val TiempoBaja: Int?,
    val IdentificadorBanco: Int?,
    val IdentificadorClienteBanco: Int?,
    val UltNrRemesa: Int?,
    val esAutorizoProteccionDatos: Boolean,
    val filaPrincipal: Int?,
    val FecExpedicionAvancarga: LocalDateTime?,
    val RodaBlancaBloqueada: Boolean?,
    val CtaContable: Int?,
) {
    companion object : com.arnyminerz.filamagenta.core.database.prototype.RemoteDataParser<Socio> {
        val EXAMPLE = Socio(
            6,
            "EXAMPLE",
            "USER DISPLAY",
            "Sample street, Alcoi",
            12,
            "123456789C",
            LocalDate.parse("1945-08-10").atStartOfDay(),
            "987654321",
            null,
            null,
            "mail@example.COM",
            1,
            null,
            true,
            LocalDate.parse("1962-05-04").atStartOfDay(),
            null,
            null,
            1965,
            null,
            null,
            bRodaBlancos = true,
            bRodaNegros = true,
            null,
            null,
            null,
            5,
            null,
            15,
            null,
            null,
            null,
            null,
            1987,
            null,
            false,
            5,
            null,
            "HA RECIBIDO MEDALLA PLATA, ORO EN 2003 Y BRILLANTES EN 2013.\nJUVENIL A FESTER 01/05/1964\nGLORIERO PREVENTORIO EN 1986",
            null,
            null,
            true,
            LocalDate.parse("2027-02-16").atStartOfDay(),
            true,
            null,
            true,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            null,
            false,
            null,
            LocalDate.parse("2022-02-16").atStartOfDay(),
            false,
            6,
        )

        private fun ResultSet.getDateTime(index: Int) = getDate(index)
            ?.toJava8()
            ?.let { LocalDate.ofInstant(it, ZoneId.systemDefault()) }
            ?.atStartOfDay()

        override fun parse(row: ResultSet): Socio = Socio(
            row.getLong(1),
            row.getString(2),
            row.getString(3),
            row.getString(4),
            row.getInt(5),
            row.getString(6),
            row.getDateTime(7),
            row.getString(8),
            row.getString(9),
            row.getString(10),
            row.getString(11),
            row.getInt(12),
            row.getInt(13),
            row.getBoolean(14),
            row.getDateTime(15),
            row.getDateTime(16),
            row.getInt(17),
            row.getInt(18),
            row.getDateTime(19),
            row.getInt(20),
            row.getBoolean(21),
            row.getBoolean(22),
            row.getInt(23),
            row.getBoolean(24),
            row.getInt(25),
            row.getInt(26),
            row.getInt(27),
            row.getInt(28),
            row.getInt(29),
            row.getInt(30),
            row.getInt(31),
            row.getInt(32),
            row.getInt(33),
            row.getInt(34),
            row.getBoolean(35),
            row.getInt(36),
            row.getInt(37),
            row.getString(38),
            row.getString(39),
            row.getInt(40),
            row.getBoolean(41),
            row.getDateTime(42),
            row.getBoolean(43),
            row.getInt(44),
            row.getBoolean(45),
            row.getBoolean(46),
            row.getDouble(47),
            row.getBoolean(48),
            row.getInt(49),
            row.getString(50),
            row.getString(51),
            row.getBoolean(52),
            row.getInt(53),
            row.getInt(54),
            row.getInt(55),
            row.getInt(56),
            row.getBoolean(57),
            row.getInt(58),
            row.getDateTime(59),
            row.getBoolean(60),
            row.getInt(61),
        )
    }

    val fullName: String by lazy {
        val name = Nombre.lowercase().capitalized()
        val surname = Apellidos.lowercase()
            .split(" ")
            .joinToString(" ") { it.capitalized() }
        "$name $surname"
    }
}
